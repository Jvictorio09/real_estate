{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>{{ lesson.title }} — Lesson 10</title>
  <script src="https://cdn.tailwindcss.com"></script>  {# remove if Tailwind is global #}
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet"/>
  <style>
    :root{ --ink:#0b1027; --muted:#64748b; --brand:#18AFAB; --soft:#f8fafc; }
    .ink{color:var(--ink)} .muted{color:var(--muted)} .brand{color:var(--brand)}
    .card{background:#fff; box-shadow:0 10px 30px rgba(2,6,23,.06)}
    .progress{height:3px; background:linear-gradient(90deg,var(--brand),#22c55e)}
    .pill{display:inline-flex;align-items:center;gap:.5rem;padding:.375rem .75rem;border-radius:.75rem;border:1px solid}
    .script{background:#f8fafc;border:1px solid #e2e8f0;border-radius:1rem;padding:1rem}
    .copy{border:1px solid #d1d5db;border-radius:.65rem;padding:.4rem .6rem;font-size:.8rem}
    .tonebtn{border:1px solid #e5e7eb;border-radius:.65rem;padding:.35rem .7rem;font-size:.8rem}
    .tonebtn[aria-pressed="true"]{border-color:#94a3b8;background:#f1f5f9}
  </style>
</head>
<body class="bg-white text-slate-900 antialiased">
    {% include "partials/chatbot.html" %}
    {% include "partials/script_generator.html" %}
    {% include "partials/esposito_fab_left.html" %}
  <!-- progress -->
  <div id="progressBar" class="fixed top-0 left-0 right-0 z-50 progress" style="width:0%"></div>

  <!-- Breadcrumb -->
  <nav class="border-b bg-white/80 backdrop-blur sticky top-0 z-40">
    <div class="max-w-6xl mx-auto px-6 py-3 flex items-center justify-between">
      <ol class="flex items-center gap-2 text-sm text-slate-500">
        <li><a href="{% url 'lesson6' %}" class="hover:text-slate-900">Lesson 6 Overview</a></li>
        <li class="text-slate-400">/</li>
        <li class="text-slate-900 font-semibold">{{ lesson.title }}</li>
      </ol>
      <div class="hidden sm:flex items-center gap-2 text-sm">
        <button class="px-3 py-1.5 rounded-lg border border-slate-200 hover:bg-slate-50">
          <i class="fa-regular fa-bookmark mr-2"></i> Save
        </button>
        <button class="px-3 py-1.5 rounded-lg border border-slate-200 hover:bg-slate-50">
          <i class="fa-solid fa-share-nodes mr-2"></i> Share
        </button>
      </div>
    </div>
  </nav>

  <!-- Hero -->
  <header>
    <div class="max-w-6xl mx-auto px-6 pt-10 pb-6">
      <p class="uppercase tracking-[.25em] text-xs brand font-semibold">Lesson 10</p>
      <h1 class="text-3xl md:text-4xl font-extrabold ink leading-tight mt-1">
        {{ lesson.subtitle|default:lesson.title }}
      </h1>
      <p class="muted mt-3 max-w-3xl">
        Scripts turn boundaries into protection, not restriction. Use these to keep clients calm, informed, and fully covered.
      </p>
      <div class="mt-4 flex flex-wrap items-center gap-2">
        <span class="pill bg-emerald-50 text-emerald-700 border-emerald-200 text-xs md:text-sm">
          <i class="fa-regular fa-clock"></i> {{ lesson.meta.duration|default:"10–15 mins" }}
        </span>
        <span class="pill bg-sky-50 text-sky-700 border-sky-200 text-xs md:text-sm">
          <i class="fa-solid fa-signal"></i> {{ lesson.meta.level|default:"All Agents" }}
        </span>
        <span class="pill bg-violet-50 text-violet-700 border-violet-200 text-xs md:text-sm">
          <i class="fa-solid fa-message"></i> Communication Tools
        </span>
      </div>
    </div>
  </header>

  <!-- Body -->
  <main class="max-w-6xl mx-auto px-6 pb-16 grid lg:grid-cols-12 gap-8">
    <!-- Content -->
    <article class="lg:col-span-8">
      <div class="card rounded-2xl p-6 md:p-8">
        <div class="prose max-w-none">
          <p class="text-slate-700">
            Movers should never be put in a position where they’re asked to take on tasks outside their scope. These scripts shift conversations from confrontation to education—protecting clients and you.
          </p>

          <hr class="my-8 border-slate-200"/>

          <!-- Core Boundary Script with Tone Switcher -->
          <section id="core-boundary">
            <div class="flex items-center justify-between gap-3">
              <h2 class="text-2xl md:text-3xl font-bold ink">Core Boundary Script</h2>
              <div class="hidden sm:flex items-center gap-2">
                <span class="text-xs text-slate-500">Tone:</span>
                <button class="tonebtn" data-tone="friendly" aria-pressed="true">Friendly</button>
                <button class="tonebtn" data-tone="professional" aria-pressed="false">Professional</button>
                <button class="tonebtn" data-tone="firm" aria-pressed="false">Firm</button>
              </div>
            </div>

            <div class="mt-4 space-y-3">
              <div class="script" id="script-core">
                <p class="text-slate-700"><strong>Client:</strong> “Can the movers disconnect the fridge line and reinstall it in the new house?”</p>
                <p class="mt-2 text-slate-800" data-variant="friendly">
                  <strong>Realtor:</strong> “Totally get why you’d ask. Movers are amazing at furniture and boxes, but anything with water, gas, or electricity needs a licensed pro. That keeps you fully protected and makes sure insurance has your back if anything happens.”
                </p>
                <p class="mt-2 text-slate-800 hidden" data-variant="professional">
                  <strong>Realtor:</strong> “Movers handle furniture and boxes. Tasks involving water, gas, or electricity must be done by licensed professionals to keep you covered and ensure any claims are valid.”
                </p>
                <p class="mt-2 text-slate-800 hidden" data-variant="firm">
                  <strong>Realtor:</strong> “No—mov ers can’t touch utilities. Anything with water, gas, or electricity has to be handled by a licensed pro so you’re protected and insurance remains valid.”
                </p>
              </div>
              <button class="copy" data-target="#script-core"><i class="fa-regular fa-copy mr-1"></i> Copy</button>
            </div>
          </section>

          <hr class="my-8 border-slate-200"/>

          <!-- Pre-Move Expectation Script -->
          <section id="pre-move">
            <h2 class="text-2xl md:text-3xl font-bold ink">Pre-Move Expectation Script</h2>
            <div class="mt-3 script" id="script-pre">
              <p class="text-slate-800"><strong>Realtor:</strong> “As you get ready, keep in mind that movers will handle furniture, boxes, and safe disassembly. Anything involving utilities, like water lines, electrical fixtures, or gas appliances, should be handled by licensed pros. I’ll help connect you with the right specialists.”</p>
            </div>
            <button class="copy" data-target="#script-pre"><i class="fa-regular fa-copy mr-1"></i> Copy</button>
          </section>

          <hr class="my-8 border-slate-200"/>

          <!-- Day-of-Move Reassurance -->
          <section id="day-of">
            <h2 class="text-2xl md:text-3xl font-bold ink">Day-of-Move Reassurance Script</h2>
            <div class="mt-3 script" id="script-day">
              <p class="text-slate-800"><strong>Realtor:</strong> “We’ve confirmed with the movers what they’ll be handling today—furniture, boxes, and disassembly. For things like the fridge water line or chandelier, we’ve arranged licensed pros. This keeps everything safe and protected.”</p>
            </div>
            <button class="copy" data-target="#script-day"><i class="fa-regular fa-copy mr-1"></i> Copy</button>
          </section>

          <hr class="my-8 border-slate-200"/>

          <!-- Insurance Awareness -->
          <section id="insurance">
            <h2 class="text-2xl md:text-3xl font-bold ink">Insurance Awareness Script</h2>
            <div class="mt-3 script" id="script-insurance">
              <p class="text-slate-700"><strong>Client:</strong> “Why can’t the movers just help with this one thing?”</p>
              <p class="text-slate-800 mt-2"><strong>Realtor:</strong> “I understand it feels like a small favor, but if they touch it and there’s damage, insurance won’t cover the cost. A plumber or electrician keeps you protected, and it avoids delays if anything goes wrong.”</p>
            </div>
            <button class="copy" data-target="#script-insurance"><i class="fa-regular fa-copy mr-1"></i> Copy</button>
          </section>

          <hr class="my-8 border-slate-200"/>

          <!-- Prohibited Items -->
          <section id="prohibited">
            <h2 class="text-2xl md:text-3xl font-bold ink">Prohibited Items Script</h2>
            <div class="mt-3 script" id="script-prohibited">
              <p class="text-slate-700"><strong>Client:</strong> “Can movers bring my plants and propane tank?”</p>
              <p class="text-slate-800 mt-2"><strong>Realtor:</strong> “Movers aren’t allowed to move plants across state lines or hazardous items like propane. It’s not that they don’t want to—it’s against regulations. I can help you find safe ways to transport those items.”</p>
            </div>
            <button class="copy" data-target="#script-prohibited"><i class="fa-regular fa-copy mr-1"></i> Copy</button>
          </section>

          <hr class="my-8 border-slate-200"/>

          <!-- Valuables -->
          <section id="valuables">
            <h2 class="text-2xl md:text-3xl font-bold ink">Valuables Script</h2>
            <div class="mt-3 script" id="script-valuables">
              <p class="text-slate-700"><strong>Client:</strong> “Can I just pack my jewelry in a dresser drawer?”</p>
              <p class="text-slate-800 mt-2"><strong>Realtor:</strong> “For your protection, movers shouldn’t handle jewelry, cash, or important documents. The safest option is for you to keep those with you so nothing irreplaceable gets misplaced.”</p>
            </div>
            <button class="copy" data-target="#script-valuables"><i class="fa-regular fa-copy mr-1"></i> Copy</button>
          </section>

          <hr class="my-8 border-slate-200"/>

          <!-- De-Escalation -->
          <section id="de-escalation">
            <h2 class="text-2xl md:text-3xl font-bold ink">De-Escalation Script</h2>
            <div class="mt-3 script" id="script-deescalate">
              <p class="text-slate-800"><strong>Realtor:</strong> “I completely understand wanting to save time. But my job is to protect you. I’d rather give you advice that prevents a $50,000 mistake than let something slide that could cause major damage.”</p>
            </div>
            <button class="copy" data-target="#script-deescalate"><i class="fa-regular fa-copy mr-1"></i> Copy</button>
          </section>

          <hr class="my-8 border-slate-200"/>

          <!-- Quick Boundary Card -->
          <section id="boundary-card">
            <div class="flex items-center justify-between gap-3">
              <h2 class="text-2xl md:text-3xl font-bold ink">Tool: Quick Boundary Card</h2>
              <button id="download-card" class="copy">
                <i class="fa-regular fa-file-pdf mr-1"></i> Download PDF
              </button>
            </div>
            <div class="mt-3 grid sm:grid-cols-2 gap-3">
              <div class="p-4 rounded-xl border border-slate-200 bg-white">
                <p class="font-semibold">Movers</p>
                <p class="text-sm text-slate-700 mt-1">Boxes, furniture, safe disassembly/reassembly.</p>
              </div>
              <div class="p-4 rounded-xl border border-slate-200 bg-white">
                <p class="font-semibold">Licensed Pros</p>
                <p class="text-sm text-slate-700 mt-1">Plumbing, gas, electricity, specialty installs.</p>
              </div>
              <div class="p-4 rounded-xl border border-slate-200 bg-white">
                <p class="font-semibold">Clients</p>
                <p class="text-sm text-slate-700 mt-1">Valuables, pets, plants, hazardous items.</p>
              </div>
              <div class="p-4 rounded-xl border border-slate-200 bg-white">
                <p class="font-semibold">Insurance</p>
                <p class="text-sm text-slate-700 mt-1">Confirm coverage and claims process in advance.</p>
              </div>
            </div>

            <div class="mt-6 p-5 rounded-xl bg-emerald-50 border border-emerald-200">
              <p class="text-slate-800"><strong>Key Takeaway:</strong> By practicing these lines, Realtors stay calm and professional—even when clients are stressed and insistent.</p>
            </div>
          </section>
        </div>

        <!-- CTA row -->
        <div class="mt-8 flex flex-wrap gap-3">
          <a href="{% if next_topic %}{% url 'lesson_detail' next_topic.slug %}{% else %}{% url 'lesson6' %}{% endif %}"
             class="px-5 py-3 rounded-xl bg-emerald-600 text-white font-semibold hover:opacity-90">
            Next Lesson
          </a>
          <a href="#" class="px-5 py-3 rounded-xl border border-slate-300 font-semibold hover:bg-slate-50">
            Download Script Pack (PDF)
          </a>
        </div>
      </div>

      <!-- Prev/Next -->
      <div class="mt-6 flex items-center justify-between text-sm text-slate-600">
        {% if prev_topic %}
          <a href="{% url 'lesson_detail' prev_topic.slug %}" class="hover:text-slate-900"><i class="fa-solid fa-arrow-left-long mr-2"></i> {{ prev_topic.title }}</a>
        {% else %}
          <a href="{% url 'lesson6' %}" class="hover:text-slate-900"><i class="fa-solid fa-arrow-left-long mr-2"></i> Back to Overview</a>
        {% endif %}
        {% if next_topic %}
          <a href="{% url 'lesson_detail' next_topic.slug %}" class="hover:text-slate-900">{{ next_topic.title }} <i class="fa-solid fa-arrow-right-long ml-2"></i></a>
        {% endif %}
      </div>
    </article>

    <!-- Sidebar -->
    <aside class="lg:col-span-4 lg:sticky lg:top-20 h-max">
      <!-- TOC -->
      <div class="card rounded-2xl p-5 mb-5">
        <div class="flex items-center justify-between mb-3">
          <h4 class="font-semibold">On this page</h4>
          <span class="text-xs text-slate-500">Lesson 10</span>
        </div>
        <nav id="toc" class="space-y-2 text-sm"></nav>
      </div>

      <!-- All topics -->
      <div class="card rounded-2xl p-5">
        <h4 class="font-semibold mb-3">All topics</h4>
        <ul class="space-y-1 text-sm">
          {% for t in all_topics %}
          <li>
            <a href="{% url 'lesson_detail' t.slug %}"
               class="block px-3 py-2 rounded-lg border border-transparent hover:border-slate-200 hover:bg-slate-50 {% if t.slug == slug %}bg-slate-100 border-slate-200{% endif %}">
              {{ forloop.counter }}. {{ t.title }}
            </a>
          </li>
          {% endfor %}
        </ul>
        <a href="{% url 'lesson6' %}" class="mt-4 inline-flex items-center gap-2 px-4 py-2 rounded-lg border border-slate-200 hover:bg-slate-50 text-sm">
          <i class="fa-solid fa-list"></i> Back to Overview
        </a>
      </div>
    </aside>
  </main>

  <footer class="py-10 border-t">
    <div class="max-w-6xl mx-auto px-6 text-xs text-slate-500">
      © <span id="year"></span> Esposito Courses • Lesson 10
    </div>
  </footer>

  <script>
    // year + progress
    document.getElementById('year').textContent = new Date().getFullYear();
    const pb = document.getElementById('progressBar');
    window.addEventListener('scroll', () => {
      const h = document.documentElement;
      const scrolled = (h.scrollTop) / (h.scrollHeight - h.clientHeight);
      pb.style.width = (scrolled * 100) + '%';
    });

    // Build TOC from h2/h3
    const content = document.querySelector('article');
    const toc = document.getElementById('toc');
    const heads = content.querySelectorAll('h2');
    const ul = document.createElement('ul'); ul.className = "space-y-1";
    heads.forEach(h => {
      if(!h.id){ h.id = h.textContent.toLowerCase().replace(/[^a-z0-9]+/g,'-').replace(/(^-|-$)/g,''); }
      const li = document.createElement('li');
      li.innerHTML = `<a href="#${h.id}" class="block px-3 py-2 rounded-lg border border-transparent hover:border-slate-200 hover:bg-slate-50">${h.textContent}</a>`;
      ul.appendChild(li);
    });
    toc.appendChild(ul);

    // Tone switcher
    const toneBtns = document.querySelectorAll('.tonebtn');
    const variants = document.querySelectorAll('#script-core [data-variant]');
    toneBtns.forEach(btn => {
      btn.addEventListener('click', () => {
        toneBtns.forEach(b => b.setAttribute('aria-pressed','false'));
        btn.setAttribute('aria-pressed','true');
        const t = btn.dataset.tone;
        variants.forEach(p => {
          p.classList.toggle('hidden', p.getAttribute('data-variant') !== t);
        });
      });
    });

    // Copy buttons
    function copyText(el){
      const temp = document.createElement('textarea');
      temp.style.position = 'fixed';
      temp.style.opacity = '0';
      temp.value = el.innerText.trim();
      document.body.appendChild(temp);
      temp.select(); document.execCommand('copy');
      document.body.removeChild(temp);
    }
    document.querySelectorAll('.copy').forEach(btn => {
      btn.addEventListener('click', () => {
        const target = document.querySelector(btn.getAttribute('data-target'));
        copyText(target);
        btn.innerHTML = '<i class="fa-solid fa-check mr-1"></i> Copied';
        setTimeout(() => btn.innerHTML = '<i class="fa-regular fa-copy mr-1"></i> Copy', 1200);
      });
    });

    // (Optional) Download boundary card as PDF — placeholder hook
    document.getElementById('download-card').addEventListener('click', () => {
      alert('In the demo, this would download a PDF handout. (Hook this to your PDF route.)');
    });
  </script>
</body>
</html>
