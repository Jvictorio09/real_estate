{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>{{ lesson.title }} — Lesson 6</title>
  <script src="https://cdn.tailwindcss.com"></script>  {# remove if Tailwind is global #}
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet"/>
  <style>
    :root{ --ink:#0b1027; --muted:#64748b; --brand:#18AFAB; --soft:#f8fafc; }
    .ink{color:var(--ink)} .muted{color:var(--muted)} .brand{color:var(--brand)}
    .card{background:#fff; box-shadow:0 10px 30px rgba(2,6,23,.06)}
    .progress{height:3px; background:linear-gradient(90deg,var(--brand),#22c55e)}
    .story h4{ font-weight:700 }
  </style>
</head>
<body class="bg-white text-slate-900 antialiased">
    {% include "partials/chatbot.html" %}
  <!-- progress -->
  <div id="progressBar" class="fixed top-0 left-0 right-0 z-50 progress" style="width:0%"></div>

  <!-- Breadcrumb -->
  <nav class="border-b bg-white/80 backdrop-blur sticky top-0 z-40">
    <div class="max-w-6xl mx-auto px-6 py-3 flex items-center justify-between">
      <ol class="flex items-center gap-2 text-sm text-slate-500">
        <li><a href="{% url 'lesson6' %}" class="hover:text-slate-900">Lesson 6 Overview</a></li>
        <li class="text-slate-400">/</li>
        <li class="text-slate-900 font-semibold">{{ lesson.title }}</li>
      </ol>
      <div class="hidden sm:flex items-center gap-2 text-sm">
        <button class="px-3 py-1.5 rounded-lg border border-slate-200 hover:bg-slate-50">
          <i class="fa-regular fa-bookmark mr-2"></i> Save
        </button>
        <button class="px-3 py-1.5 rounded-lg border border-slate-200 hover:bg-slate-50">
          <i class="fa-solid fa-share-nodes mr-2"></i> Share
        </button>
      </div>
    </div>
  </nav>

  <!-- Hero -->
  <header>
    <div class="max-w-6xl mx-auto px-6 pt-10 pb-6">
      <p class="uppercase tracking-[.25em] text-xs brand font-semibold">Lesson 6</p>
      <h1 class="text-3xl md:text-4xl font-extrabold ink leading-tight mt-1">
        {{ lesson.subtitle|default:lesson.title }}
      </h1>
      <p class="muted mt-3 max-w-3xl">
        Stories make risk real. Use them to set boundaries before mistakes happen.
      </p>
      <div class="mt-4 flex flex-wrap items-center gap-2">
        <span class="inline-flex items-center gap-2 text-xs md:text-sm px-3 py-1.5 rounded-full bg-emerald-50 text-emerald-700 border border-emerald-200">
          <i class="fa-regular fa-clock"></i> {{ lesson.meta.duration|default:"10–15 mins" }}
        </span>
        <span class="inline-flex items-center gap-2 text-xs md:text-sm px-3 py-1.5 rounded-full bg-sky-50 text-sky-700 border border-sky-200">
          <i class="fa-solid fa-signal"></i> {{ lesson.meta.level|default:"All Agents" }}
        </span>
        <span class="inline-flex items-center gap-2 text-xs md:text-sm px-3 py-1.5 rounded-full bg-amber-50 text-amber-700 border border-amber-200">
          <i class="fa-solid fa-book-open"></i> Case Studies
        </span>
      </div>
    </div>
  </header>

  <!-- Body -->
  <main class="max-w-6xl mx-auto px-6 pb-16 grid lg:grid-cols-12 gap-8">
    <!-- Content -->
    <article class="lg:col-span-8">
      <div class="card rounded-2xl p-6 md:p-8">
        <div class="prose max-w-none">
          <h2 id="why-stories-matter" class="text-2xl md:text-3xl font-bold ink">Why Stories Matter</h2>
          <p class="text-slate-700 mt-3">
            Clients often ignore rules until they hear about someone else’s nightmare. Sharing <strong>short, vivid stories</strong> makes the risk real
            and keeps you, the Realtor, from being the next headline in a client’s insurance claim.
          </p>

          <hr class="my-8 border-slate-200"/>

          <!-- Stories grid -->
          <div class="grid gap-5">
            <!-- Story 1 -->
            <section id="story-fridge" class="story p-5 rounded-xl border border-slate-200 bg-white">
              <h4 class="text-xl ink flex items-center gap-2"><i class="fa-solid fa-droplet text-emerald-600"></i> Story 1: The $50,000 Fridge Line Disaster</h4>
              <p class="text-slate-700 mt-2">
                A family asked movers to disconnect their refrigerator’s water line. The movers wanted to be helpful—but the connection failed.
                Overnight, water leaked across the kitchen floor, seeping into hardwood and cabinetry.
              </p>
              <ul class="mt-3 space-y-1 text-slate-700">
                <li><span class="font-semibold">Damage:</span> $50,000+ in flooring and kitchen repairs.</li>
                <li><span class="font-semibold">Outcome:</span> Insurance refused to pay because the movers weren’t licensed plumbers.</li>
                <li><span class="font-semibold">Lesson:</span> Even “simple” connections carry huge risk.</li>
              </ul>
            </section>

            <!-- Story 2 -->
            <section id="story-gas" class="story p-5 rounded-xl border border-slate-200 bg-white">
              <h4 class="text-xl ink flex items-center gap-2"><i class="fa-solid fa-fire-burner text-rose-600"></i> Story 2: The Gas Dryer Near-Fire</h4>
              <p class="text-slate-700 mt-2">
                A client insisted movers reconnect a gas dryer “just to save time.” The connection wasn’t secure. A slow gas leak filled the laundry room.
                Hours later, the family turned on the dryer—and smelled gas.
              </p>
              <ul class="mt-3 space-y-1 text-slate-700">
                <li><span class="font-semibold">Damage:</span> Near explosion, emergency gas shutoff, remediation fees.</li>
                <li><span class="font-semibold">Outcome:</span> Client blamed the Realtor for “not warning them.”</li>
                <li><span class="font-semibold">Lesson:</span> Gas = licensed professionals only.</li>
              </ul>
            </section>

            <!-- Story 3 -->
            <section id="story-plants" class="story p-5 rounded-xl border border-slate-200 bg-white">
              <h4 class="text-xl ink flex items-center gap-2"><i class="fa-solid fa-seedling text-green-600"></i> Story 3: The Illegal Plant Move</h4>
              <p class="text-slate-700 mt-2">
                A client wanted movers to take their potted plants to another state. Movers agreed, not realizing that crossing state lines with plants can
                violate agricultural laws. At the state border, the truck was flagged, plants were confiscated, and fines were issued.
              </p>
              <ul class="mt-3 space-y-1 text-slate-700">
                <li><span class="font-semibold">Damage:</span> Delay in delivery + fines for illegal transport.</li>
                <li><span class="font-semibold">Outcome:</span> Client demanded reimbursement from the Realtor who recommended the company.</li>
                <li><span class="font-semibold">Lesson:</span> Movers cannot legally move plants or certain perishables.</li>
              </ul>
            </section>

            <!-- Story 4 -->
            <section id="story-electronics" class="story p-5 rounded-xl border border-slate-200 bg-white">
              <h4 class="text-xl ink flex items-center gap-2"><i class="fa-solid fa-tv text-indigo-600"></i> Story 4: The Blame Game with Electronics</h4>
              <p class="text-slate-700 mt-2">
                A client didn’t test their flat-screen TV before moving. When it didn’t work after the move, they blamed the movers. Movers denied
                responsibility—but the client insisted.
              </p>
              <ul class="mt-3 space-y-1 text-slate-700">
                <li><span class="font-semibold">Damage:</span> Broken trust + Realtor caught in the middle.</li>
                <li><span class="font-semibold">Lesson:</span> Always advise clients to <strong>test electronics and appliances before moving day</strong> so movers can’t be unfairly blamed.</li>
              </ul>
            </section>

            <!-- Story 5 -->
            <section id="story-valuables" class="story p-5 rounded-xl border border-slate-200 bg-white">
              <h4 class="text-xl ink flex items-center gap-2"><i class="fa-solid fa-gem text-pink-600"></i> Story 5: Missing Jewelry and Cash</h4>
              <p class="text-slate-700 mt-2">
                One client left jewelry and cash inside a dresser. After the move, they reported items missing and accused the movers. The movers denied responsibility.
              </p>
              <ul class="mt-3 space-y-1 text-slate-700">
                <li><span class="font-semibold">Damage:</span> Thousands in alleged loss + accusations.</li>
                <li><span class="font-semibold">Lesson:</span> Movers should never handle cash, jewelry, or irreplaceable valuables. Clients must move these themselves.</li>
              </ul>
            </section>
          </div>

          <hr class="my-8 border-slate-200"/>

          <h2 id="how-to-use" class="text-2xl md:text-3xl font-bold ink">How Realtors Can Use These Stories</h2>
          <ul class="mt-4 space-y-2 text-slate-700">
            <li><span class="font-semibold">Proactive Education:</span> Share one story in advance with every client. Example: “I’ve seen a family lose $50,000 just from asking movers to disconnect a fridge line. Let’s avoid that.”</li>
            <li><span class="font-semibold">Reinforcement on Moving Day:</span> If a client asks for a “freebie,” recall a story. Example: “That sounds simple, but I’ve seen it cause tens of thousands in damage. Let’s bring in a professional.”</li>
            <li><span class="font-semibold">Boundary Protection:</span> Stories make Realtors sound credible and experienced—not just cautious.</li>
          </ul>

          <div class="mt-6 p-5 rounded-xl bg-slate-50 border border-slate-200">
            <p class="text-slate-800"><strong>Key Takeaway:</strong> Real stories turn abstract risks into <strong>concrete warnings.</strong> Use them to educate clients before mistakes happen.</p>
          </div>
        </div>

        <!-- CTA row -->
        <div class="mt-8 flex flex-wrap gap-3">
          <a href="{% if next_topic %}{% url 'lesson_detail' next_topic.slug %}{% else %}{% url 'lesson6' %}{% endif %}"
             class="px-5 py-3 rounded-xl bg-emerald-600 text-white font-semibold hover:opacity-90">
            Next Lesson
          </a>
          <a href="#" class="px-5 py-3 rounded-xl border border-slate-300 font-semibold hover:bg-slate-50">
            Download Story Pack (PDF)
          </a>
        </div>
      </div>

      <!-- Prev/Next -->
      <div class="mt-6 flex items-center justify-between text-sm text-slate-600">
        {% if prev_topic %}
          <a href="{% url 'lesson_detail' prev_topic.slug %}" class="hover:text-slate-900"><i class="fa-solid fa-arrow-left-long mr-2"></i> {{ prev_topic.title }}</a>
        {% else %}
          <a href="{% url 'lesson6' %}" class="hover:text-slate-900"><i class="fa-solid fa-arrow-left-long mr-2"></i> Back to Overview</a>
        {% endif %}
        {% if next_topic %}
          <a href="{% url 'lesson_detail' next_topic.slug %}" class="hover:text-slate-900">{{ next_topic.title }} <i class="fa-solid fa-arrow-right-long ml-2"></i></a>
        {% endif %}
      </div>
    </article>

    <!-- Sidebar -->
    <aside class="lg:col-span-4 lg:sticky lg:top-20 h-max">
      <!-- TOC -->
      <div class="card rounded-2xl p-5 mb-5">
        <div class="flex items-center justify-between mb-3">
          <h4 class="font-semibold">On this page</h4>
          <span class="text-xs text-slate-500">Lesson 6</span>
        </div>
        <nav id="toc" class="space-y-2 text-sm"></nav>
      </div>

      <!-- All topics -->
      <div class="card rounded-2xl p-5">
        <h4 class="font-semibold mb-3">All topics</h4>
        <ul class="space-y-1 text-sm">
          {% for t in all_topics %}
          <li>
            <a href="{% url 'lesson_detail' t.slug %}"
               class="block px-3 py-2 rounded-lg border border-transparent hover:border-slate-200 hover:bg-slate-50 {% if t.slug == slug %}bg-slate-100 border-slate-200{% endif %}">
              {{ forloop.counter }}. {{ t.title }}
            </a>
          </li>
          {% endfor %}
        </ul>
        <a href="{% url 'lesson6' %}" class="mt-4 inline-flex items-center gap-2 px-4 py-2 rounded-lg border border-slate-200 hover:bg-slate-50 text-sm">
          <i class="fa-solid fa-list"></i> Back to Overview
        </a>
      </div>
    </aside>
  </main>

  <footer class="py-10 border-t">
    <div class="max-w-6xl mx-auto px-6 text-xs text-slate-500">
      © <span id="year"></span> Esposito Courses • Lesson 6
    </div>
  </footer>

  <script>
    // year + progress
    document.getElementById('year').textContent = new Date().getFullYear();
    const pb = document.getElementById('progressBar');
    window.addEventListener('scroll', () => {
      const h = document.documentElement;
      const scrolled = (h.scrollTop) / (h.scrollHeight - h.clientHeight);
      pb.style.width = (scrolled * 100) + '%';
    });

    // Build TOC from h2/h3
    const content = document.querySelector('article');
    const toc = document.getElementById('toc');
    const heads = content.querySelectorAll('h2, h3, .story h4');
    const ul = document.createElement('ul'); ul.className = "space-y-1";
    heads.forEach(h => {
      if(!h.id){
        h.id = h.textContent.toLowerCase().replace(/[^a-z0-9]+/g,'-').replace(/(^-|-$)/g,'');
      }
      const li = document.createElement('li');
      li.innerHTML = `<a href="#${h.id}" class="block px-3 py-2 rounded-lg border border-transparent hover:border-slate-200 hover:bg-slate-50">${h.textContent}</a>`;
      ul.appendChild(li);
    });
    toc.appendChild(ul);
  </script>
</body>
</html>
